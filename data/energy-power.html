<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@2.0.1/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.0.0/dist/chartjs-adapter-luxon.min.js"></script>
<!-- For luxon formatting see https://github.com/moment/luxon/blob/master/docs/formatting.md -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
<script src="https://unpkg.com/js-datepicker"></script>
<link rel="stylesheet" href="https://unpkg.com/js-datepicker/dist/datepicker.min.css">

<style> 

    .tt {
         font-family: Arial, Helvetica, sans-serif;
         font-size: 20px;
         text-align: center;
         margin-bottom: 30px;
    }
    .notes {
        text-align: center;
     }
     .sub1 {
         font-family: Arial, Helvetica, sans-serif;
         font-size: 18px;
         text-align: center;
         padding-right: 60px;
         margin-bottom: 20px;
     }
     .sub2 {
         font-family: Arial, Helvetica, sans-serif;
         font-size: 18px;
         text-align: center;
         padding-bottom: 20px;
     }
     .wra {
        max-width: 1280px;
        margin: auto;
     }
     .col_lef {
        max-width: 500px;
        float: left;
     }
     .col_lef_T1 {
        max-width: 500px;
        float: left;
        padding-bottom: 30px;
     }
     .col_lef_T2 {
        max-width: 500px;
        float: left;
        padding-bottom: 40px;
     }
     .col_rig {
        max-width: 780px;
        padding-bottom: 40px;
        float: left;
     }
     .btn {
         font-size: 18px;
         font-family: Arial, Helvetica, sans-serif;
         padding: 10px 16px;
         margin: 5px;
         border-radius: 4px;
         background-color: #d3d3d3;
     }
     .lab {
         font-family: Arial, Helvetica, sans-serif;
         font-style: normal;
         white-space: nowrap;
     }

     /* Style the active class, and buttons on mouse-over */
     .active, .btn:hover {
     background-color: #1a73e8;
     color: white;
     }

     .box {
         width: 420px;
         height: 70px;
         margin: 5px 0;
         padding: 5px 20px 5px 10px;
         font-family: Arial, Helvetica, sans-serif;
         font-size: 22px;
         color: white;
         float: left;
     }
     .inner {
         height: 70px; 
         margin-top: -20px;
         text-align: right;
         display:flex;                
         align-items: center;
         justify-content: flex-end;
         font-weight: bold;
         color: white;               
     }
     .fontbig {
         font-size: 38px;            
     }
     .fontsmall {
         font-size: 25px;            
     }
     .cwra {
         width: 780px;
         height: 390px;
         margin: auto;
     }
     .cle {
         clear: left;
     }
     #ts {
         white-space: nowrap;
     }
    #con {
         max-width: 1280px;
         margin: auto;
         /* override WP theme */
        line-height: 1.0;
    }

    #pan {
         max-width: 760px;
         border: lightgrey solid 2px;
         background-color: #e7e7e7;
         padding-top: 10px;
         margin: 5px auto;
     }
     #dpk1, #dpk2 {
         margin: 10px;
         font-family: Arial, Helvetica, sans-serif;
         /* override WP theme */
         background: white;
         border: 1px solid black;
     }
     #btw {
         max-width: 1160px;
         margin: auto;
         text-align:center;
     }
     #dtw {
         max-width: 1160px;
         margin: auto;
         text-align:center;
     }
     #tot {
        background-color: #AA10FF;
        margin-bottom: 30px;
    }
    #pow1 {
        background-color: #7A65CF;
     }
    #srpm1 {
        background-color: #7A65CF;
     }
    #drpm1 {
        background-color: #7A65CF;
     }
    #opho1 {
        background-color: #7A65CF;
     }
     #ener1 {
        background-color: #7A65CF;
     }
     #pow2 {
        background-color: #DE2F55;
     }
    #srpm2 {
        background-color: #DE2F55;
     }
     #drpm2 {
        background-color: #DE2F55;
     }
    #opho2 {
        background-color: #DE2F55;
     }
     #ener2 {
        background-color: #DE2F55;
     }
     #ca_pow {
         height: 100%;                          
     }

     @media only screen and (max-width: 1420px) {
         .wra {
         max-width: 580px;                
         }
         .col_lef, .col_lef_T1, .col_lef_T2 {
         max-width: 580px;
         float: none;                
         }
         .sub1 {
         padding-right: 0;
          }
         .box {
         float: none;
         margin: 5px auto;
        }
         .col_rig {
         max-width: 580px;                
         }
         .cwra {
         width: 580px;
         height: 290px; 
         margin: auto;        
        }
     }
     @media only screen and (max-width: 610px) {
         .wra {
         max-width: 350px;
          }
          #btw {
         max-width: 300px;
          }
          #dtw {
         width: 300px;
          }                 
          .col_lef, .col_lef_T1, .col_lef_T2 {
         max-width: 350px;
         float: none;  
          }
          .sub1, .sub2 {
         padding-right: 0;
         font-size: 17px;
         margin-bottom: 10px;
          }
          .box {
         width: 320px;
         float: none;  
         margin: 5px auto;
        }
        .fontbig {
            font-size: 30px;
        }
        .fontsmall {
            font-size: 20px;
        }
          .col_rig {
         max-width: 350px;
          }
          .cwra {
              width: 350px;
              height: 290px;
              margin: auto;
          }
          
     }
     @media only screen and (max-width: 360px) {
         /* this is for really tiny phones */
        .box {
         width: 270px;
         float: none;  
         margin: 5px auto;
        }
     }
 
</style>

<script type="text/javascript">
//<!--
// DO NOT REMOVE the comment above, it stops Wordpress from escaping ampersands

// set default API query date to last day
var today_q = new Date()
today_q.setDate(today_q.getDate())

var ds1 = luxon.DateTime.fromJSDate(today_q).toFormat('yyyyLLdd')
var ds2 = luxon.DateTime.fromJSDate(today_q).toFormat('yyyyLLdd')

//check for query string and set new dates
const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
if (urlParams.has('var1')) {
        var myds1 = urlParams.get('var1')
        var myds2 = urlParams.get('var2')
        var myhighlight = urlParams.get('var3')

        var myurl = 'https://readinghydro.org:9445/api/plc/between/' + myds1 + '/' + myds2   
        // set param1 to the earlier date requested
        var param1 = myds1
        var param2 = myds2
        var param3 = myhighlight
} else {
        var myurl = 'https://readinghydro.org:9445/api/plc/between/' + ds1 + '/' + ds2
        var param1 = ds1
        var param2 = ds2
        var param3 = 0
}

GoDoIt(myurl, param1, param2, param3)

async function GoDoIt (){
var myreturn = await getData(myurl, param1, param2, param3);
var global_data = myreturn[0]
var param1 = myreturn[1]
var param2 = myreturn[2]
var param3 = myreturn[3]

        var myChart_power

        const container = document.createElement('div')
        const title = document.createElement('h1')
        const notes = document.createElement('p')
        const subtitle1_T1 = document.createElement('div')
        const subtitle1_T2 = document.createElement('div')
        const subtitle2 = document.createElement('div')
        const col_wrapper = document.createElement('div')
        const subtitle_TOT = document.createElement('div')
        const col_left = document.createElement('div')
        const col_left_T1 = document.createElement('div')
        const col_left_T2 = document.createElement('div')
        const col_right = document.createElement('div')
        const panel = document.createElement('div')
        const buttonwrap = document.createElement('div')
        const button1 = document.createElement('button')
        const button2 = document.createElement('button')
        const button3 = document.createElement('button')
        const button4 = document.createElement('button')
        const datewrap = document.createElement('div')
        const datepick1 = document.createElement('input')
        const datepick2 = document.createElement('input')
        const label1 = document.createElement('label')
        const label2 = document.createElement('label')

        const now_total = document.createElement('div')

        const nowPower_G1 = document.createElement('div')
        const nowScrewRPM_G1 = document.createElement('div')
        const nowDriveRPM_G1 = document.createElement('div')
        const nowOpHours_G1 = document.createElement('div')
        const nowEnergy_G1 = document.createElement('div')

        const inner_now_total = document.createElement('div')

        const inner_nowPower_G1 = document.createElement('div')
        const inner_nowScrewRPM_G1 = document.createElement('div')
        const inner_nowDriveRPM_G1 = document.createElement('div')
        const inner_nowOpHours_G1 = document.createElement('div')
        const inner_nowEnergy_G1 = document.createElement('div')
        const nowPower_G2 = document.createElement('div')
        const nowScrewRPM_G2 = document.createElement('div')
        const nowDriveRPM_G2 = document.createElement('div')
        const nowOpHours_G2 = document.createElement('div')
        const nowEnergy_G2 = document.createElement('div')
        const inner_nowPower_G2 = document.createElement('div')
        const inner_nowScrewRPM_G2 = document.createElement('div')
        const inner_nowDriveRPM_G2 = document.createElement('div')
        const inner_nowOpHours_G2 = document.createElement('div')
        const inner_nowEnergy_G2 = document.createElement('div')
        const canvwrap_power = document.createElement('div')
        const clear = document.createElement('p')
        const canv_power = document.createElement('canvas')
        
        container.id = "con"
        now_total.id = "tot"
        panel.id = "pan"
        buttonwrap.id = "btw"
        datewrap.id = "dtw"
        datepick1.type = "text"
        datepick1.id = "dpk1"
        datepick2.type = "text"
        datepick2.id = "dpk2"
        label1.for = "dpk1"
        label2.for = "dpk2"
        nowPower_G1.id = "pow1"
        nowScrewRPM_G1.id = "srpm1"
        nowDriveRPM_G1.id = "drpm1"
        nowOpHours_G1.id = "opho1"
        nowEnergy_G1.id = "ener1"
        nowPower_G2.id = "pow2"
        nowScrewRPM_G2.id = "srpm2"
        nowDriveRPM_G2.id = "drpm2"
        nowOpHours_G2.id = "opho2"
        nowEnergy_G2.id = "ener2"
        canv_power.id = "ca_pow"

        title.className = "tt"
        notes.className = "notes"
        subtitle_TOT.className = "sub1"
        subtitle1_T1.className = "sub1"
        subtitle1_T2.className = "sub1"
        subtitle2.className = "sub2"
        col_wrapper.className = "wra"
        col_left.className = "col_lef"
        col_left_T1.className = "col_lef_T1"
        col_left_T2.className = "col_lef_T2"
        col_right.className = "col_rig"
        now_total.className = "box"
        nowPower_G1.className = "box"
        nowScrewRPM_G1.className = "box"
        nowDriveRPM_G1.className = "box"
        nowOpHours_G1.className = "box"
        nowEnergy_G1.className = "box"
        inner_now_total.className = "inner fontbig"
        inner_nowPower_G1.className = "inner fontbig"
        inner_nowScrewRPM_G1.className = "inner fontbig"
        inner_nowDriveRPM_G1.className = "inner fontbig"
        inner_nowOpHours_G1.className = "inner fontbig"
        inner_nowEnergy_G1.className = "inner fontbig"
        nowPower_G2.className = "box"
        nowScrewRPM_G2.className = "box"
        nowDriveRPM_G2.className = "box"
        nowOpHours_G2.className = "box"
        nowEnergy_G2.className = "box"
        inner_nowPower_G2.className = "inner fontbig"
        inner_nowScrewRPM_G2.className = "inner fontbig"
        inner_nowDriveRPM_G2.className = "inner fontbig"
        inner_nowOpHours_G2.className = "inner fontbig"
        inner_nowEnergy_G2.className = "inner fontbig"
        clear.className = "cle"
        button1.className = "btn active"
        button2.className = "btn"
        button3.className = "btn"
        button4.className = "btn"
        if (param3 == 1) {
            button1.className = "btn"
            button2.className = "btn active"
            button3.className = "btn"
            button4.className = "btn"
        }
        if (param3 == 2) {
            button1.className = "btn"
            button2.className = "btn"
            button3.className = "btn active"
            button4.className = "btn"
        }
        if (param3 == 3) {
            button1.className = "btn"
            button2.className = "btn"
            button3.className = "btn"
            button4.className = "btn active"
        }
        if (param3 == 4) {
            button1.className = "btn"
            button2.className = "btn"
            button3.className = "btn"
            button4.className = "btn"
        }       
        label1.className = "lab"
        label2.className = "lab"
        canvwrap_power.className = "cwra"

        title.innerHTML = "Electrical Power Output"
        notes.innerHTML = "<a href='#notes'>See below for explanatory notes</a>"
        subtitle_TOT.innerHTML = "Total electricity generated to date<br />(both turbines)"
        subtitle1_T1.innerHTML = `Turbine 1 (Tony)<br />Current conditions: <span id="ts">${luxon.DateTime.fromISO(global_data[0].received_at).toFormat('ff')} </span>`
        subtitle1_T2.innerHTML = `Turbine 2 (Sophie)<br />Current conditions: <span id="ts">${luxon.DateTime.fromISO(global_data[0].received_at).toFormat('ff')} </span>`
        subtitle2.innerHTML = "<span>Power generation by both turbines<br />over selected period</span>"
        button1.innerHTML = "Last day"
        button1.onclick = function(){picker2.setDate(today_end, true); picker1.setDate(today, true); selectTimescale(today, today_end, param1, param2, param3)}
        button2.innerHTML = "Last week"
        button2.onclick = function(){picker2.setDate(today_end, true); picker1.setDate(lastweek, true); param3 = 1; selectTimescale(lastweek, today_end, param1, param2, param3)}
        button3.innerHTML = "Last month"
        button3.onclick = function(){picker2.setDate(today_end, true); picker1.setDate(lastmonth, true); param3 = 2; selectTimescale(lastmonth, today_end, param1, param2, param3)}
        button4.innerHTML = "Last year"
        button4.onclick = function(){picker2.setDate(today_end, true); picker1.setDate(lastyear, true); param3 = 3; selectTimescale(lastyear, today_end, param1, param2, param3)}

        now_total.innerHTML = 'Total Energy (MWh)'
        nowPower_G1.innerHTML = 'Power Generation (kW)'
        nowScrewRPM_G1.innerHTML = 'Screw Speed (RPM)'
        nowDriveRPM_G1.innerHTML = 'Drive Speed (RPM)'
        nowOpHours_G1.innerHTML = 'Total Operating (Hours)'
        nowEnergy_G1.innerHTML = 'Total Energy (MWh)'
        nowPower_G2.innerHTML = 'Power Generation (kW)'
        nowScrewRPM_G2.innerHTML = 'Screw Speed (RPM)'
        nowDriveRPM_G2.innerHTML = 'Drive Speed (RPM)'
        nowOpHours_G2.innerHTML = 'Total Operating (Hours)'
        nowEnergy_G2.innerHTML = 'Total Energy (MWh)'
        label1.innerHTML = "Start date"
        label2.innerHTML = "End date"
        inner_now_total.textContent = global_data[0].gen1_energy_mwh + global_data[0].gen2_energy_mwh
        inner_nowPower_G1.textContent = global_data[0].gen1_power_kw
        inner_nowScrewRPM_G1.textContent = global_data[0].gen1_screw_rpm
        inner_nowDriveRPM_G1.textContent = global_data[0].gen1_drive_rpm
        inner_nowOpHours_G1.textContent = global_data[0].gen1_operating_hours
        inner_nowEnergy_G1.textContent = global_data[0].gen1_energy_mwh
        inner_nowPower_G2.textContent = global_data[0].gen2_power_kw
        inner_nowScrewRPM_G2.textContent = global_data[0].gen2_screw_rpm
        inner_nowDriveRPM_G2.textContent = global_data[0].gen2_drive_rpm
        inner_nowOpHours_G2.textContent = global_data[0].gen2_operating_hours
        inner_nowEnergy_G2.textContent = global_data[0].gen2_energy_mwh

        now_total.append(inner_now_total)
        nowPower_G1.append(inner_nowPower_G1)
        nowScrewRPM_G1.append(inner_nowScrewRPM_G1)
        nowDriveRPM_G1.append(inner_nowDriveRPM_G1)
        nowOpHours_G1.append(inner_nowOpHours_G1)
        nowEnergy_G1.append(inner_nowEnergy_G1)

        nowPower_G2.append(inner_nowPower_G2)
        nowScrewRPM_G2.append(inner_nowScrewRPM_G2)
        nowDriveRPM_G2.append(inner_nowDriveRPM_G2)
        nowOpHours_G2.append(inner_nowOpHours_G2)
        nowEnergy_G2.append(inner_nowEnergy_G2)

        col_left_T1.append(subtitle_TOT, now_total, clear)
        col_left_T1.append(subtitle1_T1)
        col_left_T1.append(nowPower_G1, nowScrewRPM_G1, nowDriveRPM_G1, nowOpHours_G1, nowEnergy_G1, clear) 
        col_left_T2.append(subtitle1_T2)
        col_left_T2.append(nowPower_G2, nowScrewRPM_G2, nowDriveRPM_G2, nowOpHours_G2, nowEnergy_G2, clear) 
        col_left.append(col_left_T1, col_left_T2)

        col_right.append(subtitle2)
        buttonwrap.append(button1, button2, button3, button4, clear)
        datewrap.append(label1, datepick1, label2, datepick2, clear)
        panel.append(buttonwrap, datewrap)
        col_right.append(panel)
        canvwrap_power.append(canv_power)
        col_right.append(canvwrap_power)
        container.append(notes)
        //col_wrapper.append(title) //Hide title for Wordpress
        col_wrapper.append(col_left, col_right)
        container.append(col_wrapper)
        
        //local
        //document.body.append(container)
        //Wordpress
        var target = document.getElementsByClassName("entry-content");
        target[0].append(container)
    
    //filter by date
    let today = new Date()
    let today_end = new Date()
    let lastweek = new Date()
    let lastmonth = new Date()
    let lastyear = new Date()
    today.setDate(today.getDate())
    today_end.setDate(today.getDate())
    lastweek.setDate(today.getDate() - 7)
    lastmonth.setDate(today.getDate() - 31)
    lastyear.setDate(today.getDate() - 365)
    
    today = luxon.DateTime.fromJSDate(today).startOf('day').toJSDate()
    today_end = luxon.DateTime.fromJSDate(today).endOf('day').toJSDate()
    lastweek = luxon.DateTime.fromJSDate(lastweek).startOf('day').toJSDate()
    lastmonth = luxon.DateTime.fromJSDate(lastmonth).startOf('day').toJSDate()
    lastyear = luxon.DateTime.fromJSDate(lastyear).startOf('day').toJSDate()

    // convert params to dates
    var param1_date = luxon.DateTime.fromFormat(param1, 'yyyyLLdd').startOf('day').toJSDate()
    var param2_date = luxon.DateTime.fromFormat(param2, 'yyyyLLdd').endOf('day').toJSDate()


    var picked = false
    // datepicker
    const picker1 = datepicker('#dpk1', { id: 1, dateSelected: param1_date, onSelect: instance => {picked = true; selectTimescale(picker1.getRange().start, dayEnd(picker1.getRange().end), param1, param2, param3 ) }})
    const picker2 = datepicker('#dpk2', { id: 1, dateSelected: param2_date, onSelect: instance => {picked = true; selectTimescale(picker2.getRange().start, dayEnd(picker2.getRange().end), param1, param2, param3 ) }})

    // push end date to end of day
    function dayEnd(pick){
        var dayend = luxon.DateTime.fromJSDate(pick).endOf('day').toJSDate()
        return dayend
    }

// if reloaded with last week, month or year buttons
if (param2_date.getDate() == today.getDate()) {
   picker2.setDate(today_end, true)
}

//default timescale for first page load = last day
if (!urlParams.has('var1')) {
    selectTimescale(today, today_end, param1, param2, param3)
    picker2.setDate(today_end, true)
} else {
    selectTimescale(param1_date, param2_date, param1, param2, param3)   
}

//else select timescale using parameters from buttons or datepicker
function selectTimescale(mystart, myend, myparam1, myparam2, myparam3) {

//reload page and fetch more data if needed
        if (myparam1) {
            var myparam1_date = luxon.DateTime.fromFormat(myparam1, 'yyyyLLdd').startOf('day').toJSDate()
            } else {
                myparam1_date = today
            }

    if (mystart < myparam1_date) {
        
            if (picked == true) {
                myparam3 = 4
            } 

            var newstart = luxon.DateTime.fromJSDate(mystart).toFormat('yyyyLLdd')
            var newend = luxon.DateTime.fromJSDate(myend).toFormat('yyyyLLdd')
            var path = window.location.href.split(/[?#]/)[0] // Remove parameters and/or anchor
            location.href = path + '?var1=' + newstart + '&var2=' + newend + '&var3=' + myparam3
            return
        } 

    var selection = global_data.filter(function(item){
        return new Date(item.received_at) >= mystart
            })
            var mystarttime = mystart
            var myendtime = myend
            var mylength = myendtime - mystarttime
            if (mylength >= 172800000){
                myunit = 'day'
            }else{
                myunit = 'hour'
            }

            // Downsample if greater than 10512 data points (approx 2.5 months)
            // No of points will vary between 5256 and 10512
            if (selection.length > 10512){
                var step = Math.ceil(selection.length/10512)
                var reduced = []
                for (i = 0; i < selection.length; i++) {
                    if(i % step === 0){
                        reduced.push(selection[i])
                    }
                }
                selection = reduced
                }

            const xs = []
            const ys_tony = []
            const ys_sophie = []
            for(item of selection) {                
                //convert the timestamp to milliseconds (faster)                
                const mydate1 = new Date(item.received_at)
                const mydate = mydate1.getTime()
                xs.push(mydate);
                const mypower1 = item.gen1_power_kw.toFixed(2);
                ys_tony.push(mypower1);
                const mypower2 = item.gen2_power_kw.toFixed(2);
                ys_sophie.push(mypower2)
            }

            // Add active class to the current button on click
            var btns = document.getElementsByClassName("btn");
            for (var i = 0; i < btns.length; i++) {
            btns[i].addEventListener("click", function() {
                var current = document.getElementsByClassName("active");
                if (typeof current[0] !== 'undefined'){
                current[0].className = current[0].className.replace(" active", "");
                }
                this.className += " active";
                });
                }
             if (picked == true) {
                for (var i = 0; i < btns.length; i++) {
                    btns[i].classList.remove("active")
                }
                picked = false
            }
            

            //Set global defaults for charts
            //More settings can be global if we use Chartjs v3
            Chart.defaults.global.tooltips.callbacks.title = function(t, d) {
                                    return luxon.DateTime.fromMillis(d.labels[t[0].index]).toFormat('ff');
                                            }
            //Chart.defaults.global.animation.duration = 0 
            Chart.defaults.global.maintainAspectRatio = false
            Chart.defaults.global.title.display = true
            Chart.defaults.global.title.fontSize = 20
            Chart.defaults.global.title.fontStyle = 'bold'
            Chart.defaults.global.legend.labels.fontSize = 15
            Chart.defaults.global.legend.labels.fontStyle = 'bold'
           
            
        //Graph 7 - power generated
        if (myChart_power) {
            myChart_power.destroy();
            }

        var ctx_pow = document.getElementById('ca_pow').getContext('2d');
        myChart_power = new Chart(ctx_pow, {
                type: 'line',
                data: {
                    labels: xs,
                    datasets: [
                        {           
                        label: 'Tony (turbine 1)  ',             
                        data: ys_tony,
                        fill: true,
                        backgroundColor: 'rgba(143, 118, 242, 1)',
                        borderColor: 'rgba(143, 118, 242, 1)',
                        borderWidth: 1,
                        radius: 0,
                        },
                        {           
                        label: 'Sophie (turbine 2)',             
                        data: ys_sophie,
                        fill: true,
                        backgroundColor: 'rgba(230, 48, 86, 0.8)',
                        borderColor: 'rgba(230, 48, 86, 0.9)',
                        borderWidth: 1,
                        radius: 0,
                        },                        
                    ]
                    },
                    options: {                                
                        scales: {

                                xAxes: [{
                                    type: 'time', 
                                    time: {
                                        minUnit: myunit,
                                    },
                                    distribution: 'linear',
                                    ticks: {
                                        fontStyle: "bold",
                                        min: mystarttime,
                                        max: myendtime,
                                            },
                                    scaleLabel: {
                                        display: false,                                                                  
                                            }
                                        }

                                ],
                                yAxes: [{
                                    stacked: true,
                                    ticks: {
                                        fontSize: 15,
                                        fontStyle: "bold",
                                            },
                                            scaleLabel: {
                                        display: false                                      
                                            }
                                        }]
                                },
                        title: {
                            text: "Power (kW)",
                                },
                        legend: {
                            display: true,
                                }
                            } 
            });                
        // End of graphs

        }
        // End of selectTimescale

// closing of GoDoIt function
};


// functions
async function getData() {

    const response = await fetch(myurl) 
    const data = await response.json()
    var arr = [data, param1, param2, param3] 
    return arr           
}
    
// DO NOT REMOVE the comment below, it stops Wordpress from escaping ampersands
//--></script>  
