<meta charset="UTF-8">
        <meta name="viewport1" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/luxon@2.0.1/build/global/luxon.min.js"></script>
        <style>

           .tit {
               clear: left;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 20px;
                text-align: center;
                           }
            .sub1 {
                font-family: Arial, Helvetica, sans-serif;
                font-size: 18px;
                text-align: center;
            }
            .box {
                width: 230px;
                height: 230px;
                margin: 20px;
                padding: 5px 10px;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 17px;
                color: white;
                float: left;
            }
            .inner {
                height: 230px; 
                margin-top: -30px;
                text-align:center;
                display:flex;                
                align-items: center;
                justify-content: center;
                font-weight: bold;
                color: white;               
            }
            .font80 {
                font-size: 80px;
            }
            .font30 {
                font-size: 30px;
            }
            .cwra {
                width: 540px;
                height: 270px;
                margin: 20px;
                float: left;
            }
            .cle {
                clear: left;
            }
            .ts {
                white-space: nowrap;
            }
            .wra1 {
               /* local */
               /* max-width: 1160px; */
               /* Wordpress */
               max-width: 1080px;
               margin: auto;
            }
           #con {
                max-width: 1280px;
                margin: auto;
           }
            #pow1 {
                background-color: #ff6d56;
            }
            #pow2 {
                background-color: #ff6d56;
            }
            #srpm1 {
                background-color: #418CDA;
            }
            #srpm2 {
                background-color: #418CDA;
            }
            #stor1 {
               background-color: #ffbe0a;
            }
            #stor2 {
               background-color: #ffbe0a;
            }
            #opho1 {
               background-color: #8ac539;
            }
            #opho2 {
               background-color: #8ac539;
            }
           #tem {
               background-color: #ffbe0a;
            }
           #hum {
               background-color: #57b7dd;
            }
           #up {
               background-color: #409AE6;
            }
           #do {
               background-color: #52B4E6;
            }
           #he {
               background-color: #88D1E6;
            }
           #fl {
               background-color: #418CDA;
            }



            @media only screen and (max-width: 1190px) {
                .wra1 {
                max-width: 580px;                
                }
            }
            @media only screen and (max-width: 610px) {
                .wra1 {
                max-width: 290px;
                 }
            }
        
       </style>        

         <script>

        // Start an IIFE to use `await` at the top level
        (async function(){
        var global_data1 = await getData1();
        var global_data2 = await getData2();

        
                const container = document.createElement('div')
                const title1 = document.createElement('h1')
                const title2 = document.createElement('h1')
                const title3 = document.createElement('h1')
                const title4 = document.createElement('h1')

                const subtitle1 = document.createElement('div')
                const subtitle2 = document.createElement('div')
                const subtitle3 = document.createElement('div')
                const subtitle4 = document.createElement('div')

                const nowPower_G1 = document.createElement('div')
                const nowScrewRPM_G1 = document.createElement('div')
                const nowTorque_G1 = document.createElement('div')
                const nowOpHours_G1 = document.createElement('div')

                const nowPower_G2 = document.createElement('div')
                const nowScrewRPM_G2 = document.createElement('div')
                const nowTorque_G2 = document.createElement('div')
                const nowOpHours_G2 = document.createElement('div')

                const nowtemp = document.createElement('div')
                const nowhumid = document.createElement('div')
                
                const now_upst = document.createElement('div')
                const now_down = document.createElement('div')
                const now_head = document.createElement('div')
                const now_flow = document.createElement('div')

                const inner_nowPower_G1 = document.createElement('div')
                const inner_nowScrewRPM_G1 = document.createElement('div')
                const inner_nowTorque_G1 = document.createElement('div')
                const inner_nowOpHours_G1 = document.createElement('div')

                const inner_nowPower_G2 = document.createElement('div')
                const inner_nowScrewRPM_G2 = document.createElement('div')
                const inner_nowTorque_G2 = document.createElement('div')
                const inner_nowOpHours_G2 = document.createElement('div')

                const inner_nowtemp = document.createElement('div')
                const inner_nowhumid = document.createElement('div')
                
                const inner_now_upst = document.createElement('div')
                const inner_now_down = document.createElement('div')
                const inner_now_head = document.createElement('div')
                const inner_now_flow = document.createElement('div')
                
                const wrap11 = document.createElement('div')
                const wrap12 = document.createElement('div')
                const wrap13 = document.createElement('div')
                const wrap14 = document.createElement('div')

                const clear = document.createElement('p')

                
                container.id = "con"

                nowPower_G1.id = "pow1"
                nowScrewRPM_G1.id = "srpm1"
                nowTorque_G1.id = "stor1"
                nowOpHours_G1.id = "opho1"

                nowPower_G2.id = "pow2"
                nowScrewRPM_G2.id = "srpm2"
                nowTorque_G2.id = "stor2"
                nowOpHours_G2.id = "opho2"

                nowtemp.id = "tem"
                nowhumid.id = "hum"
                
                now_upst.id = "up"
                now_down.id = "do"
                now_head.id = "he"
                now_flow.id = "fl"

                wrap11.className = "wra1"
                wrap12.className = "wra1"
                wrap13.className = "wra1"
                wrap14.className = "wra1"

                title1.className = "tit"
                title2.className = "tit"
                title3.className = "tit"
                title4.className = "tit"
                subtitle1.className = "sub1"
                subtitle2.className = "sub1"
                subtitle3.className = "sub1"
                subtitle4.className = "sub1"

                nowPower_G1.className = "box"
                nowScrewRPM_G1.className = "box"
                nowTorque_G1.className = "box"
                nowOpHours_G1.className = "box"

                nowPower_G2.className = "box"
                nowScrewRPM_G2.className = "box"
                nowTorque_G2.className = "box"
                nowOpHours_G2.className = "box"

                nowtemp.className = "box"
                nowhumid.className = "box"
                
                now_upst.className = "box"
                now_down.className = "box"
                now_head.className = "box"
                now_flow.className = "box"

                inner_nowPower_G1.className = "inner font80"
                inner_nowScrewRPM_G1.className = "inner font80"
                inner_nowTorque_G1.className = "inner font80"
                inner_nowOpHours_G1.className = "inner font80"

                inner_nowPower_G2.className = "inner font80"
                inner_nowScrewRPM_G2.className = "inner font80"
                inner_nowTorque_G2.className = "inner font80"
                inner_nowOpHours_G2.className = "inner font80"

                inner_nowtemp.className = "inner font80"
                inner_nowhumid.className = "inner font80"

                inner_now_upst.className = "inner font80"
                inner_now_down.className = "inner font80"
                inner_now_head.className = "inner font80"
                inner_now_flow.className = "inner font80"

                clear.className = "cle"

                title3.innerHTML = '<a href="/power-output-data/">Turbine 1 (Tony)</a>'
                subtitle3.innerHTML = 'Current performance of Turbine'

                nowPower_G1.innerHTML = 'Power Generated (kW)'
                nowScrewRPM_G1.innerHTML = 'Screw Speed (RPM)'
                nowTorque_G1.innerHTML = 'Screw Torque (Nm)'
                nowOpHours_G1.innerHTML = 'Total Operating (Hours)'

                inner_nowPower_G1.textContent = global_data2.gen1_power_kw
                inner_nowScrewRPM_G1.textContent = global_data2.gen1_screw_rpm
                inner_nowTorque_G1.textContent = global_data2.gen1_torque
                inner_nowOpHours_G1.textContent = global_data2.gen1_operating_hours

                nowPower_G1.append(inner_nowPower_G1)
                nowScrewRPM_G1.append(inner_nowScrewRPM_G1)
                nowTorque_G1.append(inner_nowTorque_G1)
                nowOpHours_G1.append(inner_nowOpHours_G1)

                wrap13.append(nowPower_G1, nowScrewRPM_G1, nowTorque_G1, nowOpHours_G1, clear)
                container.append(title3)
                container.append(subtitle3)
                container.append(wrap13, clear)

                title4.innerHTML = '<a href="/power-output-data/">Turbine 2 (Sophie)</a>'
                subtitle4.innerHTML = 'Current performance of Turbine'

                nowPower_G2.innerHTML = 'Power Generated (kW)'
                nowScrewRPM_G2.innerHTML = 'Screw Speed (RPM)'
                nowTorque_G2.innerHTML = 'Screw Torque (Nm)'
                nowOpHours_G2.innerHTML = 'Total Operating (Hours)'

                inner_nowPower_G2.textContent = global_data2.gen2_power_kw
                inner_nowScrewRPM_G2.textContent = global_data2.gen2_screw_rpm
                inner_nowTorque_G2.textContent = global_data2.gen2_torque
                inner_nowOpHours_G2.textContent = global_data2.gen2_operating_hours

                nowPower_G2.append(inner_nowPower_G2)
                nowScrewRPM_G2.append(inner_nowScrewRPM_G2)
                nowTorque_G2.append(inner_nowTorque_G2)
                nowOpHours_G2.append(inner_nowOpHours_G2)

                wrap14.append(nowPower_G2, nowScrewRPM_G2, nowTorque_G2, nowOpHours_G2, clear)
                container.append(title4)
                container.append(subtitle4)
                container.append(wrap14, clear)


                title1.innerHTML = '<a href="/turbine-house-data/">Turbine House</a>'
                //Filter out other devices
                var selection1 = global_data1.filter(function(item){
                        return item.device_id == 'rdghydro-ers001'
                    })
                subtitle1.innerHTML = `Current conditions: <span class="ts">${luxon.DateTime.fromISO(selection1[0].received_at).toFormat('ff')} </span>`

                nowtemp.innerHTML = "Temperature (&deg;C)"
                nowhumid.innerHTML = "Humidity (&percnt;)"
                inner_nowtemp.textContent = selection1[0].temperature
                inner_nowhumid.textContent = selection1[0].humidity

                nowtemp.append(inner_nowtemp)
                nowhumid.append(inner_nowhumid)

                wrap11.append(nowtemp, nowhumid, clear)
                container.append(title1)
                container.append(subtitle1)
                container.append(wrap11, clear)

                title2.innerHTML = '<a href="/water-level-data/">Water levels and flow</a>'
                subtitle2.innerHTML = `Current conditions: <span class="ts">${luxon.DateTime.fromISO(global_data2.received_at).toFormat('ff')} </span>`

                now_upst.innerHTML = "Upstream (metres AOD)"
                now_down.innerHTML = "Downstream (metres AOD)"
                now_head.innerHTML = "Head (metres)" 
                now_flow.innerHTML = "Flow (cubic metres/sec)"
                inner_now_upst.textContent = global_data2.upstream.toFixed(2)
                inner_now_down.textContent = global_data2.downstream.toFixed(2)
                inner_now_head.textContent = (global_data2.upstream - global_data2.downstream).toFixed(2)
                inner_now_flow.textContent = ((global_data2.gen1_flow_ls + global_data2.gen2_flow_ls) / 1000).toFixed(2)

                now_upst.append(inner_now_upst)
                now_down.append(inner_now_down)
                now_head.append(inner_now_head)
                //now_flow.append(inner_now_flow)

                wrap12.append(now_upst, now_down, now_head, now_flow, clear)
                container.append(title2)
                container.append(subtitle2)
                container.append(wrap12, clear)
                
                //local
                //document.body.append(container)
                //Wordpress
                var target = document.getElementsByClassName("entry-content");
                target[0].append(container)

            

        //closing of IIFE function
        })();


// functions
        async function getData1() {
            const response = await fetch('https://readinghydro.org:9445/api/ttn/today') 
            const data = await response.json() 
            return data           
        }
 
        async function getData2() {
            //local
            //const response = await fetch('/powergen') 
            //Wordpress
            const response = await fetch('https://readinghydro.org:9445/api/plc/current') 
            const data = await response.json() 
            return data           
        }
        
        </script>

