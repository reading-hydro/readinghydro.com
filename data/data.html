<meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://cdn.jsdelivr.net/npm/luxon@2.0.1/build/global/luxon.min.js"></script>
        <style>

           .tt {
                font-family: Arial, Helvetica, sans-serif;
                font-size: 20px;
                text-align: center;
                margin-bottom: 30px;
                           }
            .sub_data {
                font-family: Arial, Helvetica, sans-serif;
                font-size: 18px;
                text-align: center;
                margin-bottom: 10px;
            }
            .box_data {
                width: 420px;
                height: 70px;
                margin: 5px 25px 5px 25px;
                padding: 5px 20px 5px 10px;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 22px;
                color: white;
                float: left;
            }
            .inner {
                height: 70px; 
                margin-top: -20px;
                text-align: right;
                display:flex;                
                align-items: center;
                justify-content: flex-end;
                font-weight: bold;
                color: white;             
            }
            .fontbig {
                font-size: 38px;            
            }
            .fontsmall {
                font-size: 25px;            
            }
            .cle {
                clear: left;
            }
            .ts {
                white-space: nowrap;
            }
            #wra_PO {
                max-width: 1000px;
                margin: auto;
            }

            #wra_T1 {
                max-width: 500px;
                padding-bottom: 40px;
                float: left;
            }
            #wra_T2 {
                max-width: 500px;
                padding-bottom: 40px;
                float: left;
            }
            #wra_TH_RC {
                max-width: 1000px;
                margin: auto;
            }
            #wra_TH {
                max-width: 500px;
                padding-bottom: 40px;
                float: left;
            }
            #wra_RC {
                max-width: 500px;
                padding-bottom: 40px;
                float: left;
            }
           #con {
                max-width: 1280px;
                margin: auto;
                /* override WP theme */
                line-height: 1.0;
           }
           #pow1 {
                background-color: #7A65CF;
            }
            #srpm1 {
                background-color: #7A65CF;
            }
            #stor1 {
                background-color: #7A65CF;
            }
            #drpm1 {
                background-color: #7A65CF;
            }
            #opho1 {
                background-color: #7A65CF;
            }
            #pow2 {
                background-color: #DE2F55;
            }
            #srpm2 {
                background-color: #DE2F55;
            }
            #stor2 {
                background-color: #DE2F55;
            }
            #drpm2 {
                background-color: #DE2F55;
            }
            #opho2 {
                background-color: #DE2F55;
            }
           #up {
               background-color: #418AD9;
            }
           #dow {
               background-color: #418AD9;
            }
           #he {
               background-color: #418AD9;
            }
           #ahol {
               background-color: #418AD9;
            }
           #tem {
               background-color: #ED6651;
            }
           #hum {
               background-color: #4694B3;
            }

            @media only screen and (max-width: 1100px) {
                #wra_PO, #wra_TH_RC {
                max-width: 580px;              
                }
                #wra_T1, #wra_T2, #wra_TH, #wra_RC {
                max-width: 580px;
                float: none;
                }
                .box_data {
                    float: none;
                    margin: 5px auto;
                }                
            }

            @media only screen and (max-width: 610px) {
                #wra_PO {
                max-width: 350px;
                 }
                 #wra_TH_RC {
                max-width: 350px;
                 }
                 #wra_T1, #wra_T2, #wra_TH, #wra_RC {
                padding-bottom: 20px;
                }
                 .box_data {
                    width: 320px;
                }
                .fontbig {
                    font-size: 30px;
                }
                .fontsmall {
                    font-size: 20px;
                }
                .tt {
                    font-size: 16px;
                    margin-bottom: 20px;
                }
                .sub_data {
                    font-size: 15px;
                }
            }

            @media only screen and (max-width: 360px) {
                /* this is for really tiny phones */
                .box_data {
                width: 270px;
                float: none;  
                margin: 5px auto;
                }
            }
        
       </style>        

         <script>

        // Start an IIFE to use `await` at the top level
        (async function(){
        var global_data1 = await getData1();
        var global_data2 = await getData2();

        var HOL = 36.727

        // This is the LIVE DATA summary page
                const container = document.createElement('div')                
                const title_TH = document.createElement('h1')
                const title_RC = document.createElement('h1')
                const title_PO = document.createElement('h1')

                const subtitle_TH = document.createElement('div')
                const subtitle_RC = document.createElement('div')
                const subtitle_T1 = document.createElement('div')
                const subtitle_T2 = document.createElement('div')

                const nowPower_G1 = document.createElement('div')
                const nowScrewRPM_G1 = document.createElement('div')
                const nowTorque_G1 = document.createElement('div')
                const nowDriveRPM_G1 = document.createElement('div')
                const nowOpHours_G1 = document.createElement('div')

                const nowPower_G2 = document.createElement('div')
                const nowScrewRPM_G2 = document.createElement('div')
                const nowTorque_G2 = document.createElement('div')
                const nowDriveRPM_G2 = document.createElement('div')
                const nowOpHours_G2 = document.createElement('div')
                
                const now_upst = document.createElement('div')
                const now_down = document.createElement('div')
                const now_head = document.createElement('div')
                const now_aboveHOL = document.createElement('div')

                const nowtemp = document.createElement('div')
                const nowhumid = document.createElement('div')

                const inner_nowPower_G1 = document.createElement('div')
                const inner_nowScrewRPM_G1 = document.createElement('div')
                const inner_nowTorque_G1 = document.createElement('div')
                const inner_nowDriveRPM_G1 = document.createElement('div')
                const inner_nowOpHours_G1 = document.createElement('div')

                const inner_nowPower_G2 = document.createElement('div')
                const inner_nowScrewRPM_G2 = document.createElement('div')
                const inner_nowTorque_G2 = document.createElement('div')
                const inner_nowDriveRPM_G2 = document.createElement('div')
                const inner_nowOpHours_G2 = document.createElement('div')

                const inner_now_upst = document.createElement('div')
                const inner_now_down = document.createElement('div')
                const inner_now_head = document.createElement('div')
                const inner_now_aboveHOL = document.createElement('div')

                const inner_nowtemp = document.createElement('div')
                const inner_nowhumid = document.createElement('div')
                
                const wrap_PO = document.createElement('div')
                const wrap_T1 = document.createElement('div')
                const wrap_T2 = document.createElement('div')
                const wrap_TH_RC = document.createElement('div')
                const wrap_TH = document.createElement('div')
                const wrap_RC = document.createElement('div')

                const clear = document.createElement('p')

                
                container.id = "con"

                nowPower_G1.id = "pow1"
                nowScrewRPM_G1.id = "srpm1"
                nowTorque_G1.id = "stor1"
                nowDriveRPM_G1.id = "drpm1"
                nowOpHours_G1.id = "opho1"

                nowPower_G2.id = "pow2"
                nowScrewRPM_G2.id = "srpm2"
                nowTorque_G2.id = "stor2"
                nowDriveRPM_G2.id = "drpm2"
                nowOpHours_G2.id = "opho2"
                
                now_upst.id = "up"
                now_down.id = "dow"
                now_head.id = "he"
                now_aboveHOL.id = "ahol"

                nowtemp.id = "tem"
                nowhumid.id = "hum"

                wrap_PO.id = "wra_PO"
                wrap_T1.id = "wra_T1"
                wrap_T2.id = "wra_T2"
                wrap_TH_RC.id = "wra_TH_RC"
                wrap_TH.id = "wra_TH"
                wrap_RC.id = "wra_RC"

                title_TH.className = "tt"
                title_RC.className = "tt"
                title_PO.className = "tt"
                subtitle_TH.className = "sub_data"
                subtitle_RC.className = "sub_data"
                subtitle_T1.className = "sub_data"
                subtitle_T2.className = "sub_data"

                nowPower_G1.className = "box_data"
                nowScrewRPM_G1.className = "box_data"
                nowTorque_G1.className = "box_data"
                nowDriveRPM_G1.className = "box_data"
                nowOpHours_G1.className = "box_data"

                nowPower_G2.className = "box_data"
                nowScrewRPM_G2.className = "box_data"
                nowTorque_G2.className = "box_data"
                nowDriveRPM_G2.className = "box_data"
                nowOpHours_G2.className = "box_data"
                
                now_upst.className = "box_data"
                now_down.className = "box_data"
                now_head.className = "box_data"
                now_aboveHOL.className = "box_data"

                nowtemp.className = "box_data"
                nowhumid.className = "box_data"

                inner_nowPower_G1.className = "inner fontbig"
                inner_nowScrewRPM_G1.className = "inner fontbig"
                inner_nowTorque_G1.className = "inner fontbig"
                inner_nowDriveRPM_G1.className = "inner fontbig"
                inner_nowOpHours_G1.className = "inner fontbig"

                inner_nowPower_G2.className = "inner fontbig"
                inner_nowScrewRPM_G2.className = "inner fontbig"
                inner_nowTorque_G2.className = "inner fontbig"
                inner_nowDriveRPM_G2.className = "inner fontbig"
                inner_nowOpHours_G2.className = "inner fontbig"

                inner_now_upst.className = "inner fontbig"
                inner_now_down.className = "inner fontbig"
                inner_now_head.className = "inner fontbig"
                inner_now_aboveHOL.className = "inner fontbig"

                inner_nowtemp.className = "inner fontbig"
                inner_nowhumid.className = "inner fontbig"

                clear.className = "cle"

                title_PO.innerHTML = '<a href="/power-output-data/">Power Output<br />click for data history</a>'
                subtitle_T1.innerHTML = `Turbine 1 (Tony): <span class="ts">${luxon.DateTime.fromISO(global_data2.received_at).toFormat('ff')} </span><br />Current performance of turbine and generator`

                nowPower_G1.innerHTML = 'Power Generation (kW)'
                nowScrewRPM_G1.innerHTML = 'Screw Speed (RPM)'
                nowTorque_G1.innerHTML = 'Screw Torque (Nm)'
                nowDriveRPM_G1.innerHTML = 'Drive Speed (RPM)'
                nowOpHours_G1.innerHTML = 'Total Operating (Hours)'

                inner_nowPower_G1.textContent = global_data2.gen1_power_kw
                inner_nowScrewRPM_G1.textContent = global_data2.gen1_screw_rpm
                inner_nowTorque_G1.textContent = global_data2.gen1_torque
                inner_nowDriveRPM_G1.textContent = global_data2.gen1_drive_rpm
                inner_nowOpHours_G1.textContent = global_data2.gen1_operating_hours

                nowPower_G1.append(inner_nowPower_G1)
                nowScrewRPM_G1.append(inner_nowScrewRPM_G1)
                nowTorque_G1.append(inner_nowTorque_G1)
                nowDriveRPM_G1.append(inner_nowDriveRPM_G1)
                nowOpHours_G1.append(inner_nowOpHours_G1)

                wrap_PO.append(title_PO)
                wrap_T1.append(subtitle_T1)
                wrap_T1.append(nowPower_G1, nowScrewRPM_G1, nowTorque_G1, nowDriveRPM_G1, nowOpHours_G1, clear)
                wrap_PO.append(wrap_T1)

                subtitle_T2.innerHTML = `Turbine 2 (Sophie): <span class="ts">${luxon.DateTime.fromISO(global_data2.received_at).toFormat('ff')} </span><br />Current performance of turbine and generator`

                nowPower_G2.innerHTML = 'Power Generation (kW)'
                nowScrewRPM_G2.innerHTML = 'Screw Speed (RPM)'
                nowTorque_G2.innerHTML = 'Screw Torque (Nm)'
                nowDriveRPM_G2.innerHTML = 'Drive Speed (RPM)'
                nowOpHours_G2.innerHTML = 'Total Operating (Hours)'

                inner_nowPower_G2.textContent = global_data2.gen2_power_kw
                inner_nowScrewRPM_G2.textContent = global_data2.gen2_screw_rpm
                inner_nowTorque_G2.textContent = global_data2.gen2_torque
                inner_nowDriveRPM_G2.textContent = global_data2.gen2_drive_rpm
                inner_nowOpHours_G2.textContent = global_data2.gen2_operating_hours

                nowPower_G2.append(inner_nowPower_G2)
                nowScrewRPM_G2.append(inner_nowScrewRPM_G2)
                nowTorque_G2.append(inner_nowTorque_G2)
                nowDriveRPM_G2.append(inner_nowDriveRPM_G2)
                nowOpHours_G2.append(inner_nowOpHours_G2)

                wrap_T2.append(subtitle_T2)
                wrap_T2.append(nowPower_G2, nowScrewRPM_G2, nowTorque_G2, nowDriveRPM_G2, nowOpHours_G2, clear)
                wrap_PO.append(wrap_T2)

                container.append(wrap_PO)

                title_RC.innerHTML = '<a href="/water-level-data/">River Conditions<br />click for data history</a>'
                subtitle_RC.innerHTML = `Current conditions: <span class="ts">${luxon.DateTime.fromISO(global_data2.received_at).toFormat('ff')} </span>`

                now_upst.innerHTML = "Upstream (metres AOD)"
                now_down.innerHTML = "Downstream (metres AOD)"
                now_head.innerHTML = "Head (metres)" 
                now_aboveHOL.innerHTML = "Level above hands-off (metres)"
                inner_now_upst.textContent = global_data2.upstream.toFixed(3)
                inner_now_down.textContent = global_data2.downstream.toFixed(3)
                inner_now_head.textContent = (global_data2.upstream - global_data2.downstream).toFixed(3)
                inner_now_aboveHOL.textContent = (global_data2.upstream - HOL).toFixed(3)

                now_upst.append(inner_now_upst)
                now_down.append(inner_now_down)
                now_head.append(inner_now_head)
                now_aboveHOL.append(inner_now_aboveHOL)

                wrap_RC.append(title_RC)
                wrap_RC.append(subtitle_RC)
                //wrap_RC.append(now_upst, now_down, now_head, now_aboveHOL, clear)
                wrap_RC.append(now_upst, now_down, now_head, clear)
                wrap_TH_RC.append(wrap_RC)

                title_TH.innerHTML = '<a href="/turbine-house-data/">Turbine House<br />click for data history</a>'
                //Filter out other devices
                var selection1 = global_data1.filter(function(item){
                        return item.device_id == 'rdghydro-ers001'
                    })

                subtitle_TH.innerHTML = `Current conditions: <span class="ts">${luxon.DateTime.fromISO(selection1[0].received_at).toFormat('ff')} </span>`

                nowtemp.innerHTML = "Temperature (&deg;C)"
                nowhumid.innerHTML = "Humidity (&percnt;)"

                inner_nowtemp.textContent = selection1[0].temperature
                inner_nowhumid.textContent = selection1[0].humidity

                nowtemp.append(inner_nowtemp)
                nowhumid.append(inner_nowhumid)
                
                wrap_TH.append(title_TH)
                wrap_TH.append(subtitle_TH)
                wrap_TH.append(nowtemp, nowhumid, clear)
                wrap_TH_RC.append(wrap_TH)
                container.append(wrap_TH_RC)
                
                //local
                //document.body.append(container)
                //Wordpress
                var target = document.getElementsByClassName("entry-content");
                target[0].append(container)

        //closing of IIFE function
        })();


// functions
        async function getData1() {
            const response = await fetch('https://readinghydro.org:9445/api/ttn/today') 
            const data = await response.json() 
            return data           
        }
 
        async function getData2() {
            const response = await fetch('https://readinghydro.org:9445/api/plc/current') 
            const data = await response.json() 
            return data           
        }
        
        </script>
